
import { ethers } from 'ethers';

const RPC_URL = 'https://data-seed-prebsc-1-s1.binance.org:8545';
const CONTRACT_ADDRESS = '0x52Ca4B7673646B8b922ea00ccef6DD0375B14619';

async function main() {
    const provider = new ethers.JsonRpcProvider(RPC_URL);

    // We use a low-level call to get the raw data
    const marketId = 0;

    // Function signature for markets(uint256) is usually generated by the compiler.
    // For public mapping: function markets(uint256) external view returns (...)
    // Selector: keccak256("markets(uint256)").substr(0, 10)
    const selector = ethers.id("markets(uint256)").slice(0, 10);

    // Encode the argument (marketId = 0)
    const abiCoder = new ethers.AbiCoder();
    const encodedArg = abiCoder.encode(["uint256"], [marketId]).slice(2);

    const data = selector + encodedArg;

    console.log(`Calling contract at ${CONTRACT_ADDRESS} with data: ${data}`);

    try {
        const result = await provider.call({
            to: CONTRACT_ADDRESS,
            data: data
        });

        console.log("Raw result:", result);

        if (result === '0x') {
            console.log("Returned empty result.");
            return;
        }

        // Try to decode with the CURRENT ABI assumption
        const currentAbiTypes = [
            "address", // creator
            "string",  // question
            "uint256", // endTime
            "uint8",   // status
            "uint8",   // outcome
            "address", // yesToken
            "address", // noToken
            "uint256", // yesPool
            "uint256", // noPool
            "uint256", // lpTotalSupply
            "uint256", // totalBacking
            "uint256", // platformFees
            "uint256", // resolutionRequestedAt
            "address", // resolutionRequester
            "string",  // resolutionReason
            "uint256", // resolutionConfidence
            "uint256", // disputeDeadline
            "address", // disputer
            "string"   // disputeReason
        ];

        try {
            const decoded = abiCoder.decode(currentAbiTypes, result);
            console.log("Successfully decoded with current ABI!");
            console.log("Question:", decoded[1]);
            console.log("ResolutionReason:", decoded[14]);
        } catch (e) {
            console.error("Failed to decode with current ABI:", e.message);
        }

    } catch (error) {
        console.error("Call failed:", error);
    }
}

main();
